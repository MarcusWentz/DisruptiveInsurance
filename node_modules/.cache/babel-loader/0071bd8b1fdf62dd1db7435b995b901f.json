{"ast":null,"code":"import _defineProperty from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import Web3 from\"web3\";import{CONTRACT_ADDRESS,ABI}from\"../config\";import ErrorModal from\"../components/ErrorModal\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Owner=/*#__PURE__*/function(_Component){_inherits(Owner,_Component);var _super=_createSuper(Owner);function Owner(props){var _this;_classCallCheck(this,Owner);_this=_super.call(this,props);_this.state={account:_this.props.account,successMsg:\"\",availableEth:\"\",volcanoContract:null,policyaddress:\"0x0000000000000000000000000000000000000000\",allPolicyData:\"\",accountsInsured:\"\",errorMsg:\"\",globalContractBalance:null,calculatedWEI:-1};return _this;}_createClass(Owner,[{key:\"componentDidMount\",value:function componentDidMount(){this.loadBlockchainData();this.handleChangeUserInput=this.handleChangeUserInput.bind(this);this.handleFundContract=this.handleFundContract.bind(this);this.handleClaimExpiredPolicy=this.handleClaimExpiredPolicy.bind(this);this.setInitialValues=this.setInitialValues.bind(this);this.handleSelfDestruct=this.handleSelfDestruct.bind(this);this.handleGetPolicyAddressData=this.handleGetPolicyAddressData.bind(this);this.handleClaimNotConnectedPolicy=this.handleClaimNotConnectedPolicy.bind(this);//this.handleBuyPolicy = this.handleBuyPolicy.bind(this);\n}},{key:\"loadBlockchainData\",value:function(){var _loadBlockchainData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,volcanoContract,globalContractBalance,that;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:web3=new Web3(Web3.givenProvider||\"http://localhost:8545\");//const network = await web3.eth.net.getNetworkType();\n//await window.ethereum.enable();\nvolcanoContract=new web3.eth.Contract(ABI,CONTRACT_ADDRESS);_context.next=4;return web3.eth.getBalance(CONTRACT_ADDRESS);case 4:globalContractBalance=_context.sent;this.setState({volcanoContract:volcanoContract,globalContractBalance:globalContractBalance});that=this;setTimeout(function(){var calculatedWEI=that.state.globalContractBalance-(that.state.getAvailableEth+that.state.accountsInsured);that.setState({calculatedWEI:calculatedWEI});},1000);//GET inital values\nthis.setInitialValues(volcanoContract);///----Event will automatically read data\nthis.eventListener(volcanoContract);case 10:case\"end\":return _context.stop();}}},_callee,this);}));function loadBlockchainData(){return _loadBlockchainData.apply(this,arguments);}return loadBlockchainData;}()},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){if(prevProps.account!==this.props.account){this.loadBlockchainData();}}},{key:\"setInitialValues\",value:function setInitialValues(volcanoContract){var that=this;volcanoContract.methods.OpenWEItoInsure().call().then(function(res){that.setState({getAvailableEth:res});});volcanoContract.methods.LockedWEItoPolicies().call().then(function(res){that.setState({accountsInsured:res});});}},{key:\"eventListener\",value:function eventListener(volcanoContract){var that=this;volcanoContract.events.eventBlockTime({fromBlock:\"latest\"},function(error,eventResult){}).on(\"data\",function(eventResult){//Call the get function to get the most accurate present state for the value.\nthat.setInitialValues(volcanoContract);setTimeout(function(){var calculatedWEI=that.state.globalContractBalance-(that.state.getAvailableEth+that.state.accountsInsured);that.setState({calculatedWEI:calculatedWEI});},1000);console.log(\"Eventlistener triggered!\");}).on(\"changed\",function(eventResult){// remove event from local database\n}).on(\"error\",console.error);}},{key:\"handleChangeUserInput\",value:function handleChangeUserInput(event){var value=event.target.value;var name=event.target.dataset.name;this.setState(_defineProperty({},name,value));}},{key:\"handleFundContract\",value:function handleFundContract(){if(this.props.account[0]){var web3js=new Web3(window.web3.currentProvider);web3js.eth.sendTransaction({to:CONTRACT_ADDRESS,data:this.state.volcanoContract.methods.OwnerSendOneEthToContractFromInsuranceBusiness().encodeABI(),value:1000000000000000000,from:this.props.account[0]});}else this.setState({errorMsg:\"You have to connect to metamask!\"});}},{key:\"handleClaimNotConnectedPolicy\",value:function handleClaimNotConnectedPolicy(){if(this.props.account[0]){var web3js=new Web3(window.web3.currentProvider);web3js.eth.sendTransaction({to:CONTRACT_ADDRESS,data:this.state.volcanoContract.methods.OwnerLiquidtoOpenETHToWithdraw().encodeABI(),from:this.props.account[0]});}else this.setState({errorMsg:\"You have to connect to metamask!\"});}},{key:\"handleClaimExpiredPolicy\",value:function handleClaimExpiredPolicy(){if(this.props.account[0]){var web3js=new Web3(window.web3.currentProvider);web3js.eth.sendTransaction({to:CONTRACT_ADDRESS,data:this.state.volcanoContract.methods.OwnerClaimExpiredPolicyETH(this.state.policyaddress).encodeABI(),from:this.props.account[0]});}else this.setState({errorMsg:\"You have to specify a policy address!\"});}},{key:\"handleSelfDestruct\",value:function handleSelfDestruct(){if(this.props.account[0]){var web3js=new Web3(window.web3.currentProvider);web3js.eth.sendTransaction({to:CONTRACT_ADDRESS,data:this.state.volcanoContract.methods.OwnerSelfDestructClaimETH().encodeABI(),from:this.props.account[0]});}else this.setState({errorMsg:\"You have to specify a policy address!\"});}},{key:\"handleGetPolicyAddressData\",value:function(){var _handleGetPolicyAddressData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var allPolicyData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!this.props.account[0]){_context2.next=7;break;}_context2.next=3;return this.state.volcanoContract.methods.policies(this.state.policyaddress).call();case 3:allPolicyData=_context2.sent;this.setState({allPolicyData:allPolicyData,errorMsg:\"\"});_context2.next=8;break;case 7:this.setState({errorMsg:\"You have to specify a policy address!\"});case 8:case\"end\":return _context2.stop();}}},_callee2,this);}));function handleGetPolicyAddressData(){return _handleGetPolicyAddressData.apply(this,arguments);}return handleGetPolicyAddressData;}()},{key:\"render\",value:function render(){var allPolicyData=this.state.allPolicyData;return/*#__PURE__*/_jsxs(\"div\",{className:\"App-background\",children:[this.state.errorMsg?/*#__PURE__*/_jsx(ErrorModal,{}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"center-container-buy \",children:[/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\"},children:\"Owner\"}),/*#__PURE__*/_jsxs(\"form\",{class:\"form-container-buy\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"available-eth-container owner\",children:[/*#__PURE__*/_jsx(\"h5\",{style:{textAlign:\"center\"},className:\"v-txt\",children:\"Available ETH to insure:\"}),/*#__PURE__*/_jsx(\"h6\",{style:{textAlign:\"center\"},className:\"v-txt\",children:this.state.getAvailableEth/1000000000000000000})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-dark-fund-contract\",onClick:this.handleFundContract,children:\"Fund Contract\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-dark-not-connected\",onClick:this.handleClaimNotConnectedPolicy,children:\"Claim 1 ETH not connected to a policy\"})}),/*#__PURE__*/_jsx(\"div\",{class:\"available-eth-container\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Accounts Insured: \",/*#__PURE__*/_jsx(\"br\",{}),this.state.accountsInsured/1000000000000000000]})}),/*#__PURE__*/_jsx(\"div\",{className:\"container policyaddress\",children:/*#__PURE__*/_jsxs(\"div\",{class:\"label-input-container\",children:[/*#__PURE__*/_jsx(\"label\",{for:\"long\",children:\"POLICY ADDRESS\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"policyaddress\",placeholder:\"Policy Address . . .\",onChange:this.handleChangeUserInput,value:this.state.policyaddress,\"data-name\":\"policyaddress\",style:{width:500}})]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{style:{color:\"orange\"}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-dark-policy-data\",onClick:this.handleGetPolicyAddressData,children:\"Get Policy Data\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\" \",\"Lat: \"+allPolicyData.LatitudeInsured+\" Long: \"+allPolicyData.LongitudeInsured+\" Sign Date: \"+allPolicyData.YearSigned+\"/\"+allPolicyData.MonthSigned+\"/\"+allPolicyData.DaySigned+\" ETH Locked: \"+allPolicyData.EthereumAwardTiedToAddress]})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-dark-expired-policy\",onClick:this.handleClaimExpiredPolicy,children:\"Claim 1 ETH from expired policy\"})}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(\"label\",{children:\"Amount of self-destructed WEI:\"}),this.state.calculatedWEI,/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-dark-self-destruct\",onClick:this.handleSelfDestruct,children:\"Claim all ETH from a self-destruct attack\"})})]})]})]});}}]);return Owner;}(Component);export default Owner;","map":{"version":3,"sources":["/home/johanna/InsureDisruption/Frontend/insuredisrupt/src/pages/Owner.js"],"names":["React","Component","Web3","CONTRACT_ADDRESS","ABI","ErrorModal","Owner","props","state","account","successMsg","availableEth","volcanoContract","policyaddress","allPolicyData","accountsInsured","errorMsg","globalContractBalance","calculatedWEI","loadBlockchainData","handleChangeUserInput","bind","handleFundContract","handleClaimExpiredPolicy","setInitialValues","handleSelfDestruct","handleGetPolicyAddressData","handleClaimNotConnectedPolicy","web3","givenProvider","eth","Contract","getBalance","setState","that","setTimeout","getAvailableEth","eventListener","prevProps","prevState","methods","OpenWEItoInsure","call","then","res","LockedWEItoPolicies","events","eventBlockTime","fromBlock","error","eventResult","on","console","log","event","value","target","name","dataset","web3js","window","currentProvider","sendTransaction","to","data","OwnerSendOneEthToContractFromInsuranceBusiness","encodeABI","from","OwnerLiquidtoOpenETHToWithdraw","OwnerClaimExpiredPolicyETH","OwnerSelfDestructClaimETH","policies","textAlign","width","color","LatitudeInsured","LongitudeInsured","YearSigned","MonthSigned","DaySigned","EthereumAwardTiedToAddress"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Web3 from \"web3\";\nimport { CONTRACT_ADDRESS, ABI } from \"../config\";\nimport ErrorModal from \"../components/ErrorModal\";\nclass Owner extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\taccount: this.props.account,\n\t\t\tsuccessMsg: \"\",\n\t\t\tavailableEth: \"\",\n\t\t\tvolcanoContract: null,\n\t\t\tpolicyaddress: \"0x0000000000000000000000000000000000000000\",\n\t\t\tallPolicyData: \"\",\n\t\t\taccountsInsured: \"\",\n\t\t\terrorMsg: \"\",\n\t\t\tglobalContractBalance: null,\n\t\t\tcalculatedWEI: -1,\n\t\t};\n\t}\n\tcomponentDidMount() {\n\t\tthis.loadBlockchainData();\n\t\tthis.handleChangeUserInput = this.handleChangeUserInput.bind(this);\n\t\tthis.handleFundContract = this.handleFundContract.bind(this);\n\t\tthis.handleClaimExpiredPolicy =\n\t\t\tthis.handleClaimExpiredPolicy.bind(this);\n\n\t\tthis.setInitialValues = this.setInitialValues.bind(this);\n\t\tthis.handleSelfDestruct = this.handleSelfDestruct.bind(this);\n\t\tthis.handleGetPolicyAddressData =\n\t\t\tthis.handleGetPolicyAddressData.bind(this);\n\n\t\tthis.handleClaimNotConnectedPolicy =\n\t\t\tthis.handleClaimNotConnectedPolicy.bind(this);\n\n\t\t//this.handleBuyPolicy = this.handleBuyPolicy.bind(this);\n\t}\n\n\tasync loadBlockchainData() {\n\t\tconst web3 = new Web3(Web3.givenProvider || \"http://localhost:8545\");\n\t\t//const network = await web3.eth.net.getNetworkType();\n\t\t//await window.ethereum.enable();\n\t\tconst volcanoContract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);\n\t\tlet globalContractBalance = await web3.eth.getBalance(CONTRACT_ADDRESS);\n\n\t\tthis.setState({\n\t\t\tvolcanoContract: volcanoContract,\n\t\t\tglobalContractBalance: globalContractBalance,\n\t\t});\n\n\t\tlet that = this;\n\t\tsetTimeout(function () {\n\t\t\tlet calculatedWEI =\n\t\t\t\tthat.state.globalContractBalance -\n\t\t\t\t(that.state.getAvailableEth + that.state.accountsInsured);\n\t\t\tthat.setState({ calculatedWEI: calculatedWEI });\n\t\t}, 1000);\n\n\t\t//GET inital values\n\t\tthis.setInitialValues(volcanoContract);\n\t\t///----Event will automatically read data\n\t\tthis.eventListener(volcanoContract);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (prevProps.account !== this.props.account) {\n\t\t\tthis.loadBlockchainData();\n\t\t}\n\t}\n\n\tsetInitialValues(volcanoContract) {\n\t\tlet that = this;\n\t\tvolcanoContract.methods\n\t\t\t.OpenWEItoInsure()\n\t\t\t.call()\n\t\t\t.then((res) => {\n\t\t\t\tthat.setState({\n\t\t\t\t\tgetAvailableEth: res,\n\t\t\t\t});\n\t\t\t});\n\n\t\tvolcanoContract.methods\n\t\t\t.LockedWEItoPolicies()\n\t\t\t.call()\n\t\t\t.then((res) => {\n\t\t\t\tthat.setState({\n\t\t\t\t\taccountsInsured: res,\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\teventListener(volcanoContract) {\n\t\tlet that = this;\n\t\tvolcanoContract.events\n\t\t\t.eventBlockTime(\n\t\t\t\t{\n\t\t\t\t\tfromBlock: \"latest\",\n\t\t\t\t},\n\t\t\t\tfunction (error, eventResult) {}\n\t\t\t)\n\t\t\t.on(\"data\", function (eventResult) {\n\t\t\t\t//Call the get function to get the most accurate present state for the value.\n\t\t\t\tthat.setInitialValues(volcanoContract);\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tlet calculatedWEI =\n\t\t\t\t\t\tthat.state.globalContractBalance -\n\t\t\t\t\t\t(that.state.getAvailableEth +\n\t\t\t\t\t\t\tthat.state.accountsInsured);\n\t\t\t\t\tthat.setState({ calculatedWEI: calculatedWEI });\n\t\t\t\t}, 1000);\n\t\t\t\tconsole.log(\"Eventlistener triggered!\");\n\t\t\t})\n\t\t\t.on(\"changed\", function (eventResult) {\n\t\t\t\t// remove event from local database\n\t\t\t})\n\t\t\t.on(\"error\", console.error);\n\t}\n\n\thandleChangeUserInput(event) {\n\t\tlet value = event.target.value;\n\t\tlet name = event.target.dataset.name;\n\t\tthis.setState({ [name]: value });\n\t}\n\n\thandleFundContract() {\n\t\tif (this.props.account[0]) {\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.OwnerSendOneEthToContractFromInsuranceBusiness()\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tvalue: 1000000000000000000,\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to connect to metamask!\",\n\t\t\t});\n\t}\n\n\thandleClaimNotConnectedPolicy() {\n\t\tif (this.props.account[0]) {\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.OwnerLiquidtoOpenETHToWithdraw()\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to connect to metamask!\",\n\t\t\t});\n\t}\n\n\thandleClaimExpiredPolicy() {\n\t\tif (this.props.account[0]) {\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.OwnerClaimExpiredPolicyETH(this.state.policyaddress)\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to specify a policy address!\",\n\t\t\t});\n\t}\n\n\thandleSelfDestruct() {\n\t\tif (this.props.account[0]) {\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.OwnerSelfDestructClaimETH()\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to specify a policy address!\",\n\t\t\t});\n\t}\n\n\tasync handleGetPolicyAddressData() {\n\t\tif (this.props.account[0]) {\n\t\t\tlet allPolicyData = await this.state.volcanoContract.methods\n\t\t\t\t.policies(this.state.policyaddress)\n\t\t\t\t.call();\n\t\t\tthis.setState({\n\t\t\t\tallPolicyData: allPolicyData,\n\t\t\t\terrorMsg: \"\",\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to specify a policy address!\",\n\t\t\t});\n\t}\n\n\trender() {\n\t\tconst { allPolicyData } = this.state;\n\n\t\treturn (\n\t\t\t<div className=\"App-background\">\n\t\t\t\t{this.state.errorMsg ? <ErrorModal /> : null}\n\n\t\t\t\t<div className=\"center-container-buy \">\n\t\t\t\t\t<h2 style={{ textAlign: \"center\" }}>Owner</h2>\n\n\t\t\t\t\t<form class=\"form-container-buy\">\n\t\t\t\t\t\t<div class=\"available-eth-container owner\">\n\t\t\t\t\t\t\t<h5\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tAvailable ETH to insure:\n\t\t\t\t\t\t\t</h5>\n\t\t\t\t\t\t\t<h6\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{this.state.getAvailableEth /\n\t\t\t\t\t\t\t\t\t1000000000000000000}\n\t\t\t\t\t\t\t</h6>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\"btn btn-dark-fund-contract\"\n\t\t\t\t\t\t\tonClick={this.handleFundContract}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tFund Contract\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-not-connected\"\n\t\t\t\t\t\t\t\tonClick={this.handleClaimNotConnectedPolicy}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tClaim 1 ETH not connected to a policy\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"available-eth-container\">\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\tAccounts Insured: <br />\n\t\t\t\t\t\t\t\t{this.state.accountsInsured /\n\t\t\t\t\t\t\t\t\t1000000000000000000}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"container policyaddress\">\n\t\t\t\t\t\t\t<div class=\"label-input-container\">\n\t\t\t\t\t\t\t\t<label for=\"long\">POLICY ADDRESS</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tname=\"policyaddress\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Policy Address . . .\"\n\t\t\t\t\t\t\t\t\tonChange={this.handleChangeUserInput}\n\t\t\t\t\t\t\t\t\tvalue={this.state.policyaddress}\n\t\t\t\t\t\t\t\t\tdata-name=\"policyaddress\"\n\t\t\t\t\t\t\t\t\tstyle={{ width: 500 }}\n\t\t\t\t\t\t\t\t></input>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<p style={{ color: \"orange\" }}></p>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-policy-data\"\n\t\t\t\t\t\t\t\tonClick={this.handleGetPolicyAddressData}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tGet Policy Data\n\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t{\" \"}\n\t\t\t\t\t\t\t\t{\"Lat: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.LatitudeInsured +\n\t\t\t\t\t\t\t\t\t\" Long: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.LongitudeInsured +\n\t\t\t\t\t\t\t\t\t\" Sign Date: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.YearSigned +\n\t\t\t\t\t\t\t\t\t\"/\" +\n\t\t\t\t\t\t\t\t\tallPolicyData.MonthSigned +\n\t\t\t\t\t\t\t\t\t\"/\" +\n\t\t\t\t\t\t\t\t\tallPolicyData.DaySigned +\n\t\t\t\t\t\t\t\t\t\" ETH Locked: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.EthereumAwardTiedToAddress}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-expired-policy\"\n\t\t\t\t\t\t\t\tonClick={this.handleClaimExpiredPolicy}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tClaim 1 ETH from expired policy\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t<label>Amount of self-destructed WEI:</label>\n\n\t\t\t\t\t\t{this.state.calculatedWEI}\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-self-destruct\"\n\t\t\t\t\t\t\t\tonClick={this.handleSelfDestruct}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tClaim all ETH from a self-destruct attack\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Owner;\n"]},"metadata":{},"sourceType":"module"}