{"ast":null,"code":"var _jsxFileName = \"/home/johanna/InsureDisruption/Frontend/insuredisrupt/src/pages/Buy.js\";\nimport React, { Component } from \"react\";\nimport Web3 from \"web3\";\nimport { CONTRACT_ADDRESS, ABI } from \"../config\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Buy extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      account: \"default\",\n      successMsg: \"\",\n      availableEth: \"\",\n      volcanoContract: null,\n      lat: 0,\n      long: 0,\n      getAvailableEth: null,\n      allPolicyData: \"\",\n      errorMsg: \"\"\n    };\n  }\n\n  componentDidMount() {\n    this.loadBlockchainData();\n    this.handleChangeUserInput = this.handleChangeUserInput.bind(this);\n    this.handleBuyPolicy = this.handleBuyPolicy.bind(this);\n    this.handleClaimReward = this.handleClaimReward.bind(this);\n    this.eventListener = this.eventListener.bind(this);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevProps.account !== this.props.account) {\n      this.loadBlockchainData();\n    }\n  }\n\n  async loadBlockchainData() {\n    const web3 = new Web3(Web3.givenProvider || \"http://localhost:8545\"); //const network = await web3.eth.net.getNetworkType();\n    //await window.ethereum.enable();\n    //Load the smart contract\n\n    const volcanoContract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);\n    this.setState({\n      volcanoContract: volcanoContract\n    });\n    console.log(this.state.volcanoContract, \"CONTRAACT\"); //Set state for the result from storedData() Q: this is what i did before with await?\n\n    volcanoContract.methods.urlRebuiltJSON().call((err, result) => {\n      if (result === undefined) {\n        console.log(err, \"ERR\");\n      } else {\n        //this.setState({ storedDataResult: result });\n        console.log(result, \"result returned storedData()\");\n      }\n    }); //GET inital values\n\n    let availableEth = await volcanoContract.methods.OpenETHtoInsure().call();\n    this.setState({\n      getAvailableEth: availableEth\n    });\n    console.log(this.state.getAvailableEth, \"avail eth:\"); //Get if user has policy and when signed\n\n    if (this.props.account[0]) {\n      let allPolicyData = await volcanoContract.methods.policies(this.props.account[0]).call();\n      this.setState({\n        allPolicyData: allPolicyData\n      });\n    }\n\n    this.eventListener(volcanoContract);\n  }\n\n  eventListener(volcanoContract) {\n    let that = this;\n    console.log(\"Inside event listner\");\n    volcanoContract.events.recordMessageSender({\n      fromBlock: \"latest\"\n    }, function (error, eventResult) {}).on(\"data\", function (eventResult) {\n      //Call the get function to get the most accurate present state for the value.\n      volcanoContract.methods.OpenETHtoInsure().call((err, result) => {\n        that.setState({\n          getAvailableEth: result,\n          loading: false\n        });\n        console.log(result, \"Eventlistener result\");\n      });\n      volcanoContract.methods.policies(that.props.account[0]).call((err, result) => {\n        that.setState({\n          allPolicyData: result,\n          loading: false\n        });\n        console.log(result, \"2Eventlistener result\");\n      });\n    }).on(\"changed\", function (eventResult) {// remove event from local database\n    }).on(\"error\", console.error);\n  }\n\n  handleBuyPolicy() {\n    if (this.props.account[0]) {\n      console.log(\"Buu Buy policy\", this.state.volcanoContract, this.state.lat, this.state.long);\n      let web3js = new Web3(window.web3.currentProvider);\n      web3js.eth.sendTransaction({\n        to: CONTRACT_ADDRESS,\n        data: this.state.volcanoContract.methods.BuyerCreatePolicy(this.state.lat, this.state.long).encodeABI(),\n        value: 10000000000000000,\n        from: this.props.account[0]\n      });\n    } else return /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"No account connected\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 17\n    }, this);\n  }\n\n  handleClaimReward() {\n    console.log(\"Handle claim reward\");\n\n    if (this.props.account[0]) {\n      let web3js = new Web3(window.web3.currentProvider);\n      web3js.eth.sendTransaction({\n        to: CONTRACT_ADDRESS,\n        data: this.state.volcanoContract.methods.BuyerClaimReward(this.props.account[0]).encodeABI(),\n        from: this.props.account[0]\n      });\n    } else this.setState({\n      errorMsg: \"You have to connect to metamask!\"\n    });\n  }\n\n  handleChangeUserInput(event) {\n    let value = event.target.value;\n    let name = event.target.dataset.name;\n    this.setState({\n      [name]: value\n    });\n    console.log(this.state.lat, this.state.long, \"handleChange?\");\n  }\n\n  render() {\n    const {\n      allPolicyData\n    } = this.state;\n    console.log(this.state.allPolicyData, \"All Policy data\");\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App-background\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"center-container-buy \",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            textAlign: \"center\"\n          },\n          children: \"Buy Insurance\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          class: \"form-container-buy\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"available-eth-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              children: \"Metamask connected policy:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n              style: {\n                textAlign: \"center\"\n              },\n              className: \"v-txt\",\n              children: \"Lat: \" + allPolicyData.LatitudeInsured + \" Long: \" + allPolicyData.LongitudeInsured + \" Sign Date: \" + allPolicyData.YearSigned + \"/\" + allPolicyData.MonthSigned + \"/\" + allPolicyData.DaySigned + \" ETH Locked: \" + allPolicyData.EthereumAwardTiedToAddress\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"available-eth-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              style: {\n                textAlign: \"center\"\n              },\n              className: \"v-txt\",\n              children: \"Available ETH to insure:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              style: {\n                textAlign: \"center\"\n              },\n              className: \"v-txt\",\n              children: this.state.getAvailableEth\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container longLat\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              class: \"label-input-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                for: \"lat\",\n                children: \"Latitude\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 201,\n                columnNumber: 9\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                name: \"lat\",\n                placeholder: \"Latitude . . . \",\n                onChange: this.handleChangeUserInput,\n                \"data-name\": \"lat\",\n                value: this.state.lat\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 202,\n                columnNumber: 9\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 8\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              class: \"label-input-container\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                for: \"long\",\n                children: \"Longitude\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 9\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                name: \"long\",\n                placeholder: \"Longitude . . .\",\n                onChange: this.handleChangeUserInput,\n                value: this.state.long,\n                \"data-name\": \"long\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 9\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 8\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              class: \"btn btn-dark-buy-policy\",\n              onClick: this.handleBuyPolicy,\n              children: \"Buy Policy\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 225,\n              columnNumber: 8\n            }, this), this.handleBuyPolicy()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              class: \"btn btn-dark-claim\",\n              onClick: this.handleClaimReward,\n              children: \"Claim Reward\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 8\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 4\n    }, this);\n  }\n\n}\n\nexport default Buy;","map":{"version":3,"sources":["/home/johanna/InsureDisruption/Frontend/insuredisrupt/src/pages/Buy.js"],"names":["React","Component","Web3","CONTRACT_ADDRESS","ABI","Buy","constructor","props","state","account","successMsg","availableEth","volcanoContract","lat","long","getAvailableEth","allPolicyData","errorMsg","componentDidMount","loadBlockchainData","handleChangeUserInput","bind","handleBuyPolicy","handleClaimReward","eventListener","componentDidUpdate","prevProps","prevState","web3","givenProvider","eth","Contract","setState","console","log","methods","urlRebuiltJSON","call","err","result","undefined","OpenETHtoInsure","policies","that","events","recordMessageSender","fromBlock","error","eventResult","on","loading","web3js","window","currentProvider","sendTransaction","to","data","BuyerCreatePolicy","encodeABI","value","from","BuyerClaimReward","event","target","name","dataset","render","textAlign","LatitudeInsured","LongitudeInsured","YearSigned","MonthSigned","DaySigned","EthereumAwardTiedToAddress"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Web3 from \"web3\";\nimport { CONTRACT_ADDRESS, ABI } from \"../config\";\n\nclass Buy extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\taccount: \"default\",\n\t\t\tsuccessMsg: \"\",\n\t\t\tavailableEth: \"\",\n\t\t\tvolcanoContract: null,\n\t\t\tlat: 0,\n\t\t\tlong: 0,\n\t\t\tgetAvailableEth: null,\n\t\t\tallPolicyData: \"\",\n\t\t\terrorMsg: \"\",\n\t\t};\n\t}\n\tcomponentDidMount() {\n\t\tthis.loadBlockchainData();\n\t\tthis.handleChangeUserInput = this.handleChangeUserInput.bind(this);\n\t\tthis.handleBuyPolicy = this.handleBuyPolicy.bind(this);\n\t\tthis.handleClaimReward = this.handleClaimReward.bind(this);\n\t\tthis.eventListener = this.eventListener.bind(this);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (prevProps.account !== this.props.account) {\n\t\t\tthis.loadBlockchainData();\n\t\t}\n\t}\n\tasync loadBlockchainData() {\n\t\tconst web3 = new Web3(Web3.givenProvider || \"http://localhost:8545\");\n\t\t//const network = await web3.eth.net.getNetworkType();\n\t\t//await window.ethereum.enable();\n\n\t\t//Load the smart contract\n\t\tconst volcanoContract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);\n\t\tthis.setState({ volcanoContract: volcanoContract });\n\t\tconsole.log(this.state.volcanoContract, \"CONTRAACT\");\n\n\t\t//Set state for the result from storedData() Q: this is what i did before with await?\n\t\tvolcanoContract.methods.urlRebuiltJSON().call((err, result) => {\n\t\t\tif (result === undefined) {\n\t\t\t\tconsole.log(err, \"ERR\");\n\t\t\t} else {\n\t\t\t\t//this.setState({ storedDataResult: result });\n\t\t\t\tconsole.log(result, \"result returned storedData()\");\n\t\t\t}\n\t\t});\n\n\t\t//GET inital values\n\t\tlet availableEth = await volcanoContract.methods\n\t\t\t.OpenETHtoInsure()\n\t\t\t.call();\n\t\tthis.setState({ getAvailableEth: availableEth });\n\t\tconsole.log(this.state.getAvailableEth, \"avail eth:\");\n\n\t\t//Get if user has policy and when signed\n\t\tif (this.props.account[0]) {\n\t\t\tlet allPolicyData = await volcanoContract.methods\n\t\t\t\t.policies(this.props.account[0])\n\t\t\t\t.call();\n\t\t\tthis.setState({\n\t\t\t\tallPolicyData: allPolicyData,\n\t\t\t});\n\t\t}\n\n\t\tthis.eventListener(volcanoContract);\n\t}\n\n\teventListener(volcanoContract) {\n\t\tlet that = this;\n\t\tconsole.log(\"Inside event listner\");\n\t\tvolcanoContract.events\n\t\t\t.recordMessageSender(\n\t\t\t\t{\n\t\t\t\t\tfromBlock: \"latest\",\n\t\t\t\t},\n\t\t\t\tfunction (error, eventResult) {}\n\t\t\t)\n\t\t\t.on(\"data\", function (eventResult) {\n\t\t\t\t//Call the get function to get the most accurate present state for the value.\n\t\t\t\tvolcanoContract.methods\n\t\t\t\t\t.OpenETHtoInsure()\n\t\t\t\t\t.call((err, result) => {\n\t\t\t\t\t\tthat.setState({\n\t\t\t\t\t\t\tgetAvailableEth: result,\n\t\t\t\t\t\t\tloading: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconsole.log(result, \"Eventlistener result\");\n\t\t\t\t\t});\n\n\t\t\t\tvolcanoContract.methods\n\t\t\t\t\t.policies(that.props.account[0])\n\t\t\t\t\t.call((err, result) => {\n\t\t\t\t\t\tthat.setState({\n\t\t\t\t\t\t\tallPolicyData: result,\n\t\t\t\t\t\t\tloading: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconsole.log(result, \"2Eventlistener result\");\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.on(\"changed\", function (eventResult) {\n\t\t\t\t// remove event from local database\n\t\t\t})\n\t\t\t.on(\"error\", console.error);\n\t}\n\n\thandleBuyPolicy() {\n\t\tif (this.props.account[0]) {\n\t\t\tconsole.log(\n\t\t\t\t\"Buu Buy policy\",\n\t\t\t\tthis.state.volcanoContract,\n\t\t\t\tthis.state.lat,\n\t\t\t\tthis.state.long\n\t\t\t);\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.BuyerCreatePolicy(this.state.lat, this.state.long)\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tvalue: 10000000000000000,\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else return <p>No account connected</p>;\n\t}\n\n\thandleClaimReward() {\n\t\tconsole.log(\"Handle claim reward\");\n\t\tif (this.props.account[0]) {\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.BuyerClaimReward(this.props.account[0])\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to connect to metamask!\",\n\t\t\t});\n\t}\n\n\thandleChangeUserInput(event) {\n\t\tlet value = event.target.value;\n\t\tlet name = event.target.dataset.name;\n\t\tthis.setState({ [name]: value });\n\t\tconsole.log(this.state.lat, this.state.long, \"handleChange?\");\n\t}\n\n\trender() {\n\t\tconst { allPolicyData } = this.state;\n\t\tconsole.log(this.state.allPolicyData, \"All Policy data\");\n\t\treturn (\n\t\t\t<div className=\"App-background\">\n\t\t\t\t<div className=\"center-container-buy \">\n\t\t\t\t\t<h2 style={{ textAlign: \"center\" }}>Buy Insurance</h2>\n\n\t\t\t\t\t<form class=\"form-container-buy\">\n\t\t\t\t\t\t<div class=\"available-eth-container\">\n\t\t\t\t\t\t\t<label>Metamask connected policy:</label>\n\t\t\t\t\t\t\t<h6\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{\"Lat: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.LatitudeInsured +\n\t\t\t\t\t\t\t\t\t\" Long: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.LongitudeInsured +\n\t\t\t\t\t\t\t\t\t\" Sign Date: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.YearSigned +\n\t\t\t\t\t\t\t\t\t\"/\" +\n\t\t\t\t\t\t\t\t\tallPolicyData.MonthSigned +\n\t\t\t\t\t\t\t\t\t\"/\" +\n\t\t\t\t\t\t\t\t\tallPolicyData.DaySigned +\n\t\t\t\t\t\t\t\t\t\" ETH Locked: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.EthereumAwardTiedToAddress}\n\t\t\t\t\t\t\t</h6>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"available-eth-container\">\n\t\t\t\t\t\t\t<h3\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tAvailable ETH to insure:\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<h3\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{this.state.getAvailableEth}\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"container longLat\">\n\t\t\t\t\t\t\t<div class=\"label-input-container\">\n\t\t\t\t\t\t\t\t<label for=\"lat\">Latitude</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tname=\"lat\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Latitude . . . \"\n\t\t\t\t\t\t\t\t\tonChange={this.handleChangeUserInput}\n\t\t\t\t\t\t\t\t\tdata-name=\"lat\"\n\t\t\t\t\t\t\t\t\tvalue={this.state.lat}\n\t\t\t\t\t\t\t\t></input>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"label-input-container\">\n\t\t\t\t\t\t\t\t<label for=\"long\">Longitude</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tname=\"long\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Longitude . . .\"\n\t\t\t\t\t\t\t\t\tonChange={this.handleChangeUserInput}\n\t\t\t\t\t\t\t\t\tvalue={this.state.long}\n\t\t\t\t\t\t\t\t\tdata-name=\"long\"\n\t\t\t\t\t\t\t\t></input>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-buy-policy\"\n\t\t\t\t\t\t\t\tonClick={this.handleBuyPolicy}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tBuy Policy\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{this.handleBuyPolicy()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-claim\"\n\t\t\t\t\t\t\t\tonClick={this.handleClaimReward}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tClaim Reward\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Buy;\n"]},"metadata":{},"sourceType":"module"}