{"ast":null,"code":"import _defineProperty from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/johanna/InsureDisruption/Frontend/insuredisrupt/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import Web3 from\"web3\";import{CONTRACT_ADDRESS,ABI}from\"../config\";import ErrorModal from\"../components/ErrorModal\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Buy=/*#__PURE__*/function(_Component){_inherits(Buy,_Component);var _super=_createSuper(Buy);function Buy(props){var _this;_classCallCheck(this,Buy);_this=_super.call(this,props);_this.state={account:\"default\",successMsg:\"\",availableEth:\"\",volcanoContract:null,lat:0,long:0,getAvailableEth:null,allPolicyData:\"\",errorMsg:\"\"};return _this;}_createClass(Buy,[{key:\"componentDidMount\",value:function componentDidMount(){this.loadBlockchainData();this.handleChangeUserInput=this.handleChangeUserInput.bind(this);this.handleBuyPolicy=this.handleBuyPolicy.bind(this);this.handleClaimReward=this.handleClaimReward.bind(this);this.eventListener=this.eventListener.bind(this);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){if(prevProps.account!==this.props.account){this.loadBlockchainData();}}},{key:\"loadBlockchainData\",value:function(){var _loadBlockchainData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,volcanoContract,availableEth,allPolicyData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:web3=new Web3(Web3.givenProvider||\"http://localhost:8545\");//const network = await web3.eth.net.getNetworkType();\n//await window.ethereum.enable();\n//Load the smart contract\nvolcanoContract=new web3.eth.Contract(ABI,CONTRACT_ADDRESS);this.setState({volcanoContract:volcanoContract});console.log(this.state.volcanoContract,\"CONTRAACT\");//Set state for the result from storedData() Q: this is what i did before with await?\nvolcanoContract.methods.urlRebuiltJSON().call(function(err,result){if(result===undefined){console.log(err,\"ERR\");}else{//this.setState({ storedDataResult: result });\nconsole.log(result,\"result returned storedData()\");}});//GET inital values\n_context.next=7;return volcanoContract.methods.OpenWEItoInsure().call();case 7:availableEth=_context.sent;this.setState({getAvailableEth:availableEth});console.log(this.state.getAvailableEth,\"avail eth:\");//Get if user has policy and when signed\nif(!this.props.account[0]){_context.next=15;break;}_context.next=13;return volcanoContract.methods.policies(this.props.account[0]).call();case 13:allPolicyData=_context.sent;this.setState({allPolicyData:allPolicyData});case 15:this.eventListener(volcanoContract);case 16:case\"end\":return _context.stop();}}},_callee,this);}));function loadBlockchainData(){return _loadBlockchainData.apply(this,arguments);}return loadBlockchainData;}()},{key:\"eventListener\",value:function eventListener(volcanoContract){var that=this;console.log(\"Inside event listner\");volcanoContract.events.eventBlockTime({fromBlock:\"latest\"},function(error,eventResult){}).on(\"data\",function(eventResult){//Call the get function to get the most accurate present state for the value.\nvolcanoContract.methods.OpenWEItoInsure().call(function(err,result){that.setState({getAvailableEth:result,loading:false});console.log(result,\"Eventlistener result\");});if(that.props.account[0]){volcanoContract.methods.policies(that.props.account[0]).call(function(err,result){that.setState({allPolicyData:result,loading:false});console.log(result,\"2Eventlistener result\");});}else{that.setState({errorMsg:\"Account not defined! Need metamask acc\",loading:false});}}).on(\"changed\",function(eventResult){// remove event from local database\n}).on(\"error\",console.error);}},{key:\"handleBuyPolicy\",value:function handleBuyPolicy(){if(this.props.account[0]){console.log(\"Buu Buy policy\",this.state.volcanoContract,this.state.lat,this.state.long);var web3js=new Web3(window.web3.currentProvider);web3js.eth.sendTransaction({to:CONTRACT_ADDRESS,data:this.state.volcanoContract.methods.BuyerCreatePolicy(this.state.lat,this.state.long).encodeABI(),value:10000000000000000,from:this.props.account[0]});}else this.setState({errorMsg:\"You have to connect to metamask!\"});}},{key:\"handleClaimReward\",value:function handleClaimReward(){console.log(\"Handle claim reward\");if(this.props.account[0]){var web3js=new Web3(window.web3.currentProvider);web3js.eth.sendTransaction({to:CONTRACT_ADDRESS,data:this.state.volcanoContract.methods.BuyerClaimReward().encodeABI(),from:this.props.account[0]});}else this.setState({errorMsg:\"You have to connect to metamask!\"});}},{key:\"handleChangeUserInput\",value:function handleChangeUserInput(event){var value=event.target.value;var name=event.target.dataset.name;this.setState(_defineProperty({},name,value));console.log(this.state.lat,this.state.long,\"handleChange?\");}},{key:\"render\",value:function render(){var allPolicyData=this.state.allPolicyData;console.log(this.state.allPolicyData,\"All Policy data\");return/*#__PURE__*/_jsxs(\"div\",{className:\"App-background\",children:[this.state.errorMsg?/*#__PURE__*/_jsx(ErrorModal,{}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"center-container-buy \",children:[/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\"},children:\"Buyer\"}),/*#__PURE__*/_jsxs(\"form\",{class:\"form-container-buy\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"available-eth-container\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Metamask connected policy:\"}),/*#__PURE__*/_jsx(\"h6\",{style:{textAlign:\"center\"},className:\"v-txt\",children:\"Lat: \"+allPolicyData.LatitudeInsured+\" Long: \"+allPolicyData.LongitudeInsured+\" Sign Date: \"+allPolicyData.YearSigned+\"/\"+allPolicyData.MonthSigned+\"/\"+allPolicyData.DaySigned+\" ETH Locked: \"+allPolicyData.EthereumAwardTiedToAddress})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"available-eth-container\",children:[/*#__PURE__*/_jsx(\"h5\",{style:{textAlign:\"center\"},className:\"v-txt\",children:\"Available ETH to insure:\"}),/*#__PURE__*/_jsx(\"h3\",{style:{textAlign:\"center\"},className:\"v-txt\",children:this.state.getAvailableEth/1000000000000000000})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"container longLat\",children:[/*#__PURE__*/_jsxs(\"div\",{class:\"label-input-container\",children:[/*#__PURE__*/_jsx(\"label\",{for:\"lat\",children:\"Latitude (example 100 = 1.00)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"lat\",placeholder:\"Latitude . . . \",onChange:this.handleChangeUserInput,\"data-name\":\"lat\",value:this.state.lat})]}),/*#__PURE__*/_jsxs(\"div\",{class:\"label-input-container\",children:[/*#__PURE__*/_jsx(\"label\",{for:\"long\",children:\"Longitude (example 100 = 1.00)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"long\",placeholder:\"Longitude . . .\",onChange:this.handleChangeUserInput,value:this.state.long,\"data-name\":\"long\"})]})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-dark-buy-policy\",onClick:this.handleBuyPolicy,children:\"Buy Policy\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",class:\"btn btn-dark-claim\",onClick:this.handleClaimReward,children:\"Claim Reward\"})})]})]})]});}}]);return Buy;}(Component);export default Buy;","map":{"version":3,"sources":["/home/johanna/InsureDisruption/Frontend/insuredisrupt/src/pages/Buy.js"],"names":["React","Component","Web3","CONTRACT_ADDRESS","ABI","ErrorModal","Buy","props","state","account","successMsg","availableEth","volcanoContract","lat","long","getAvailableEth","allPolicyData","errorMsg","loadBlockchainData","handleChangeUserInput","bind","handleBuyPolicy","handleClaimReward","eventListener","prevProps","prevState","web3","givenProvider","eth","Contract","setState","console","log","methods","urlRebuiltJSON","call","err","result","undefined","OpenWEItoInsure","policies","that","events","eventBlockTime","fromBlock","error","eventResult","on","loading","web3js","window","currentProvider","sendTransaction","to","data","BuyerCreatePolicy","encodeABI","value","from","BuyerClaimReward","event","target","name","dataset","textAlign","LatitudeInsured","LongitudeInsured","YearSigned","MonthSigned","DaySigned","EthereumAwardTiedToAddress"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Web3 from \"web3\";\nimport { CONTRACT_ADDRESS, ABI } from \"../config\";\nimport ErrorModal from \"../components/ErrorModal\";\n\nclass Buy extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\taccount: \"default\",\n\t\t\tsuccessMsg: \"\",\n\t\t\tavailableEth: \"\",\n\t\t\tvolcanoContract: null,\n\t\t\tlat: 0,\n\t\t\tlong: 0,\n\t\t\tgetAvailableEth: null,\n\t\t\tallPolicyData: \"\",\n\t\t\terrorMsg: \"\",\n\t\t};\n\t}\n\tcomponentDidMount() {\n\t\tthis.loadBlockchainData();\n\t\tthis.handleChangeUserInput = this.handleChangeUserInput.bind(this);\n\t\tthis.handleBuyPolicy = this.handleBuyPolicy.bind(this);\n\t\tthis.handleClaimReward = this.handleClaimReward.bind(this);\n\t\tthis.eventListener = this.eventListener.bind(this);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (prevProps.account !== this.props.account) {\n\t\t\tthis.loadBlockchainData();\n\t\t}\n\t}\n\tasync loadBlockchainData() {\n\t\tconst web3 = new Web3(Web3.givenProvider || \"http://localhost:8545\");\n\t\t//const network = await web3.eth.net.getNetworkType();\n\t\t//await window.ethereum.enable();\n\n\t\t//Load the smart contract\n\t\tconst volcanoContract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);\n\t\tthis.setState({ volcanoContract: volcanoContract });\n\t\tconsole.log(this.state.volcanoContract, \"CONTRAACT\");\n\n\t\t//Set state for the result from storedData() Q: this is what i did before with await?\n\t\tvolcanoContract.methods.urlRebuiltJSON().call((err, result) => {\n\t\t\tif (result === undefined) {\n\t\t\t\tconsole.log(err, \"ERR\");\n\t\t\t} else {\n\t\t\t\t//this.setState({ storedDataResult: result });\n\t\t\t\tconsole.log(result, \"result returned storedData()\");\n\t\t\t}\n\t\t});\n\n\t\t//GET inital values\n\t\tlet availableEth = await volcanoContract.methods\n\t\t\t.OpenWEItoInsure()\n\t\t\t.call();\n\t\tthis.setState({ getAvailableEth: availableEth });\n\t\tconsole.log(this.state.getAvailableEth, \"avail eth:\");\n\n\t\t//Get if user has policy and when signed\n\t\tif (this.props.account[0]) {\n\t\t\tlet allPolicyData = await volcanoContract.methods\n\t\t\t\t.policies(this.props.account[0])\n\t\t\t\t.call();\n\t\t\tthis.setState({\n\t\t\t\tallPolicyData: allPolicyData,\n\t\t\t});\n\t\t}\n\n\t\tthis.eventListener(volcanoContract);\n\t}\n\n\teventListener(volcanoContract) {\n\t\tlet that = this;\n\t\tconsole.log(\"Inside event listner\");\n\t\tvolcanoContract.events\n\t\t\t.eventBlockTime(\n\t\t\t\t{\n\t\t\t\t\tfromBlock: \"latest\",\n\t\t\t\t},\n\t\t\t\tfunction (error, eventResult) {}\n\t\t\t)\n\t\t\t.on(\"data\", function (eventResult) {\n\t\t\t\t//Call the get function to get the most accurate present state for the value.\n\t\t\t\tvolcanoContract.methods\n\t\t\t\t\t.OpenWEItoInsure()\n\t\t\t\t\t.call((err, result) => {\n\t\t\t\t\t\tthat.setState({\n\t\t\t\t\t\t\tgetAvailableEth: result,\n\t\t\t\t\t\t\tloading: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconsole.log(result, \"Eventlistener result\");\n\t\t\t\t\t});\n\n\t\t\t\tif (that.props.account[0]) {\n\t\t\t\t\tvolcanoContract.methods\n\t\t\t\t\t\t.policies(that.props.account[0])\n\t\t\t\t\t\t.call((err, result) => {\n\t\t\t\t\t\t\tthat.setState({\n\t\t\t\t\t\t\t\tallPolicyData: result,\n\t\t\t\t\t\t\t\tloading: false,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconsole.log(result, \"2Eventlistener result\");\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthat.setState({\n\t\t\t\t\t\terrorMsg: \"Account not defined! Need metamask acc\",\n\t\t\t\t\t\tloading: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"changed\", function (eventResult) {\n\t\t\t\t// remove event from local database\n\t\t\t})\n\t\t\t.on(\"error\", console.error);\n\t}\n\n\thandleBuyPolicy() {\n\t\tif (this.props.account[0]) {\n\t\t\tconsole.log(\n\t\t\t\t\"Buu Buy policy\",\n\t\t\t\tthis.state.volcanoContract,\n\t\t\t\tthis.state.lat,\n\t\t\t\tthis.state.long\n\t\t\t);\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.BuyerCreatePolicy(this.state.lat, this.state.long)\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tvalue: 10000000000000000,\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to connect to metamask!\",\n\t\t\t});\n\t}\n\n\thandleClaimReward() {\n\t\tconsole.log(\"Handle claim reward\");\n\t\tif (this.props.account[0]) {\n\t\t\tlet web3js = new Web3(window.web3.currentProvider);\n\t\t\tweb3js.eth.sendTransaction({\n\t\t\t\tto: CONTRACT_ADDRESS,\n\t\t\t\tdata: this.state.volcanoContract.methods\n\t\t\t\t\t.BuyerClaimReward()\n\t\t\t\t\t.encodeABI(),\n\t\t\t\tfrom: this.props.account[0],\n\t\t\t});\n\t\t} else\n\t\t\tthis.setState({\n\t\t\t\terrorMsg: \"You have to connect to metamask!\",\n\t\t\t});\n\t}\n\n\thandleChangeUserInput(event) {\n\t\tlet value = event.target.value;\n\t\tlet name = event.target.dataset.name;\n\t\tthis.setState({ [name]: value });\n\t\tconsole.log(this.state.lat, this.state.long, \"handleChange?\");\n\t}\n\n\trender() {\n\t\tconst { allPolicyData } = this.state;\n\t\tconsole.log(this.state.allPolicyData, \"All Policy data\");\n\t\treturn (\n\t\t\t<div className=\"App-background\">\n\t\t\t\t{this.state.errorMsg ? <ErrorModal /> : null}\n\n\t\t\t\t<div className=\"center-container-buy \">\n\t\t\t\t\t<h2 style={{ textAlign: \"center\" }}>Buyer</h2>\n\n\t\t\t\t\t<form class=\"form-container-buy\">\n\t\t\t\t\t\t<div class=\"available-eth-container\">\n\t\t\t\t\t\t\t<label>Metamask connected policy:</label>\n\t\t\t\t\t\t\t<h6\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{\"Lat: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.LatitudeInsured +\n\t\t\t\t\t\t\t\t\t\" Long: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.LongitudeInsured +\n\t\t\t\t\t\t\t\t\t\" Sign Date: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.YearSigned +\n\t\t\t\t\t\t\t\t\t\"/\" +\n\t\t\t\t\t\t\t\t\tallPolicyData.MonthSigned +\n\t\t\t\t\t\t\t\t\t\"/\" +\n\t\t\t\t\t\t\t\t\tallPolicyData.DaySigned +\n\t\t\t\t\t\t\t\t\t\" ETH Locked: \" +\n\t\t\t\t\t\t\t\t\tallPolicyData.EthereumAwardTiedToAddress}\n\t\t\t\t\t\t\t</h6>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"available-eth-container\">\n\t\t\t\t\t\t\t<h5\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tAvailable ETH to insure:\n\t\t\t\t\t\t\t</h5>\n\t\t\t\t\t\t\t<h3\n\t\t\t\t\t\t\t\tstyle={{ textAlign: \"center\" }}\n\t\t\t\t\t\t\t\tclassName=\"v-txt\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{this.state.getAvailableEth /\n\t\t\t\t\t\t\t\t\t1000000000000000000}\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"container longLat\">\n\t\t\t\t\t\t\t<div class=\"label-input-container\">\n\t\t\t\t\t\t\t\t<label for=\"lat\">\n\t\t\t\t\t\t\t\t\tLatitude (example 100 = 1.00)\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tname=\"lat\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Latitude . . . \"\n\t\t\t\t\t\t\t\t\tonChange={this.handleChangeUserInput}\n\t\t\t\t\t\t\t\t\tdata-name=\"lat\"\n\t\t\t\t\t\t\t\t\tvalue={this.state.lat}\n\t\t\t\t\t\t\t\t></input>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"label-input-container\">\n\t\t\t\t\t\t\t\t<label for=\"long\">\n\t\t\t\t\t\t\t\t\tLongitude (example 100 = 1.00)\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tname=\"long\"\n\t\t\t\t\t\t\t\t\tplaceholder=\"Longitude . . .\"\n\t\t\t\t\t\t\t\t\tonChange={this.handleChangeUserInput}\n\t\t\t\t\t\t\t\t\tvalue={this.state.long}\n\t\t\t\t\t\t\t\t\tdata-name=\"long\"\n\t\t\t\t\t\t\t\t></input>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-buy-policy\"\n\t\t\t\t\t\t\t\tonClick={this.handleBuyPolicy}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tBuy Policy\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tclass=\"btn btn-dark-claim\"\n\t\t\t\t\t\t\t\tonClick={this.handleClaimReward}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tClaim Reward\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default Buy;\n"]},"metadata":{},"sourceType":"module"}